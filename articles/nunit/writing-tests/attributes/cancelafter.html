<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">

  <head>
    <meta charset="utf-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PCB5BYBNM2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-PCB5BYBNM2');
    </script>
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>CancelAfter | NUnit Docs </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="CancelAfter | NUnit Docs ">
    
    
      <link rel="shortcut icon" href="../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../../toc.html">
      <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="cancelafterattribute">
<h1 id="cancelafter">CancelAfter</h1>

<p>Normally, NUnit simply runs tests and waits for them to terminate -- the test is allowed to run indefinitely. For
certain kinds of tests, however, it may be desirable to specify a timeout value.</p>
<p>For .NET Core and later,
<a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.thread.abort?view=net-8.0"><code>Thread.Abort</code></a> as used by the
<a href="timeout.html"><code>TimeoutAttribute</code></a> can no longer be used, and there is therefore no way to interrupt an endless loop.</p>
<p>For all tests, one could use the <code>--blame-hang(-timeout)</code>  options of <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-test#options"><code>dotnet test</code></a>. However, this will stop any further
execution of the remaining tests.</p>
<p>To still be able to cancel tests, one has to move to cooperative cancellation. See <a href="https://learn.microsoft.com/en-us/dotnet/standard/threading/cancellation-in-managed-threads">Cancellation in Managed
Threads</a> using a
<a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.cancellationtoken?view=net-8.0">`CancellationToken``</a>.</p>
<p>The <code>CancelAfterAttribute</code> is used to specify a timeout value in milliseconds for a test case. If the test case runs
longer than the time specified, the supplied <code>CancellationToken</code> is set to canceled. It is however up to the test code
to check this token, either directly or indirectly.</p>
<p>The specified timeout value covers the test setup and teardown as well as the test method itself. Before and after
actions may also be included, depending on where they were specified. Since the timeout may occur during any of these
execution phases, no guarantees can be made as to what will be run and any of these phases of execution may be
incomplete. If only used on a test, once a test has timed out, its teardown methods are executed.</p>
<p>The attribute may also be specified on a fixture, in which case it indicates the default timeout for any subordinate
test cases. When using the console runner, it is also possible to specify a default timeout on the command-line.</p>
<p>When used on test methods, NUnit automatically adds an extra argument to your method containing the NUnit
<code>CancellationToken</code>. If you want to check for cancellation in <code>SetUp</code> methods, you can use
<code>TestContext.CurrentContext.CancellationToken</code></p>
<h2 id="example">Example</h2>
<pre><code class="lang-csharp">[Test, CancelAfter(2000)]
public void RunningTestUntilCanceled(CancellationToken token)
{
    while (!token.IsCancellationRequested)
    {
        /* */
    }
}

[CancelAfter(2000)]
[TestCase(&quot;http://server1&quot;)]
[TestCase(&quot;http://server2&quot;)]
public async Task PotentiallyLongRunningTest(string uri, CancellationToken token)
{
    HttpClient client = _httpClientFactory.CreateClient();
    HttpContent content = CreateContent();
    await client.PostAync(uri, content, token);
    HttpResponseMessage response = await client.GetAsync(uri, token);
    /* */
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>When debugging a unit test, i.e. when a debugger is attached to the process, the timeout is not enforced.</p>
</div>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="timeout.html">Timeout Attribute</a></li>
<li><a href="maxtime.html">MaxTime Attribute</a></li>
</ul>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nunit/docs/blob/master/docs/articles/nunit/writing-tests/attributes/cancelafter.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Generated by <strong>DocFX</strong></span> | Copyright (c) 2018-<span id="currentYear"></span> The NUnit Project - Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
